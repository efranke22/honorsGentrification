---
title: "Defining Gentrification"
author: "Erin Franke"
date: "9/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the 3rd file in my data cleaning and exploration process. \
Steps in this file: Identify gentrifiable census tracts in 2010. \

## Load libraries and data 

```{r}
library(tidyverse)
library(survey)
library(srvyr)
library(sf)
library(PrettyCols)
library(ggtext)
library(showtext)
font_add_google("Roboto Condensed")
font_add_google("Lora")
showtext_auto()
```

```{r}
roads <- st_read("ShpData/tl_2019_27_prisecroads")
load("Data/tractData/originalTidycensus/acs2010.RData")
load("Data/tractData/cleaned/final_condensed_msp.RData")
load("Data/tractData/cleaned/final_condensed.RData")
load("Data/tractData/cleaned/acs2000clean.RData")
load("Data/tractData/originalTidycensus/acs2000.RData")
```


## Method for defining gentrifiable census tracts: Lei Ding

Lei Ding (2016) of the Federal Reserve Bank of Philadelphia (2016) defines a gentrifiable tract as one that has: 
- median household income is less than the citywide median income

Identify gentrifiable tracts in 2000:

```{r}
ding2000 <- census2000clean %>%
  mutate(city = case_when(county_2000 == "Hennepin" ~ "Minneapolis", 
                          TRUE ~ "Saint Paul")) %>%
  group_by(city) %>%
  mutate(cityMedInc = median(medianIncome_2000), 
         canGent2000 = as.factor(case_when(medianIncome_2000 > cityMedInc ~ "No", 
                                      TRUE ~ "Yes"))) %>%
  select(tract_2000, canGent2000)
```

Identify gentrifiable census tracts in 2010

```{r}
ding2010 <- final_condensed_msp %>%
  group_by(city) %>%
  mutate(cityMedInc = median(medianIncome_2010), 
         canGent2010 = as.factor(case_when(medianIncome_2010 > cityMedInc ~ "No", 
                                      TRUE ~ "Yes"))) %>%
  select(tractmod, city, canGent2010)
```

Combine years

```{r}
gentrifiable <- ding2010 %>%
  left_join(ding2000, by = c("tractmod" = "tract_2000", "city")) %>%
  st_drop_geometry()

gentrifiable <- final_condensed_msp %>%
  left_join(gentrifiable, by = c("tractmod", "city"))
```


## Combine methods and identify gentrifiable tracts

Create a map of the 2010 census tracts, colored by whether or not the tract can gentrify. 

```{r}
roads_sub <- st_crop(roads,st_bbox(gentrifiable))

gentrifiable %>%
  ggplot()+
  geom_sf(aes(fill=canGent2010, color = city), lwd = 0.4)+
  geom_sf(data = roads_sub, fill = "gray",color = "gray", lwd= 0.5)+
  theme_classic()+
  scale_color_manual(values = c("goldenrod", "forestgreen"))+
  labs(title = "Gentrifiable census tracts in Minneapolis-Saint Paul city limits in 2010", fill = "Gentrifiable", x = "", y = "", color = "City")+
  annotate("point", x = -93.1691, y = 44.938, colour = "white", size = 1) +
  theme(axis.line = element_blank(), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(),
        legend.title = element_markdown(family = "mono"),
        legend.text =  element_markdown(family = "mono"),
        plot.title.position = "plot", 
        plot.title = element_markdown(family = "mono", size = 10))+
  scale_fill_pretty_d(name = "Autumn", direction = -1)+
  annotate(geom = "text", x = -93.1691, y = 44.945, label = "Macalester \nCollege", size = 2, color = "white")+
  guides(color = guide_legend(override.aes = list(size=2,alpha=1)))
```

Write the gentrifiable file to the Data folder for future use. 

```{r,eval=FALSE}
save(gentrifiable, file = 'Data/tractData/cleaned/gentrifiable.RData')
```





