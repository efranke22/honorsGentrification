---
title: "Defining Gentrification"
author: "Erin Franke"
date: "9/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidycensus)
library(tidyverse)
library(survey)
library(srvyr)
library(sf)
library(PrettyCols)
library(ggtext)
library(ggrepel)
river_lakes <- st_read("ShpData/shp_water_lakes_rivers")
roads <- st_read("ShpData/tl_2019_27_prisecroads")
```

# Create organized table of 2010 census tract information

```{r}
tract2010 <- dicennial2010 %>%
  left_join(acs2010, by = c("tract", "county", "GEOID"))
```

# Methods for defining gentrifiable tracts

Lei Ding (2016) of the Federal Reserve Bank of Philadelphia (2016) \
- median household income is less than the citywide median income

```{r}
gentDing <- tract2010 %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  group_by(county) %>%
  mutate(countyAvgInc = weighted.mean(medianIncome, TotalPopRace), 
         Ding = case_when(medianIncome > countyAvgInc ~ 0, 
                          TRUE ~ 1)) %>%
  select(-countyAvgInc)
```

Professor Lance Freeman (2005): all three measurements below must be met
- restricts analysis to neighborhoods within the central city of any given metropolitan area. \
- isolates low-income census tracts, using the metropolitan area median housing income as the comparison rather than the citywide median. \
- looks at the share of the housing stock built within the previous 20 years as a measure of relative disinvestment. Tracts in which the share of housing built in the previous 20 years is less than the median for all tracts throughout the metropolitan area are identified.

```{r}
# find metro area mean income
tract2010 %>%
  st_drop_geometry() %>%
  summarize(meanMetroInc = weighted.mean(medianIncome, TotalPopRace, na.rm = TRUE))

# find average amount of housing built in the last twenty years and identify gentrifiable tracts accordingly
gentFreeman <- tract2010 %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  mutate(built1980to2004 = (built2000to2004 + built1990to1999 + built1980to1989)  / totalStructure, 
         medianRecHome = weighted.mean(built1980to2004, totalStructure, na.rm = TRUE), 
         freeman = case_when(medianIncome <= 35167.87 & built1980to2004 <= medianRecHome ~ 1, 
                             TRUE ~ 0)) %>%
  select(freeman, tract) %>%
  st_drop_geometry()
```

Professor Lisa Bates (2013): census tracts must meet at least 3/4 of the criteria \
- a higher percentage of renters than the citywide rate \
- a higher percentage of people of color than citywide \
- a larger share of low-income households than the citywide rate \
- a lower rate of residents with bachelorâ€™s degrees than the citywide rate \

```{r}
gentBates <- tract2010 %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  group_by(county) %>%
  mutate(CityAvgRent = weighted.mean(RentOccupied/OwnershipTotal, OwnershipTotal),
         CityPoc = weighted.mean((TotalPopRace - PopWhiteAlone)/TotalPopRace, TotalPopRace), 
         CityAvgInc = weighted.mean(medianIncome, TotalPopRace), 
         CityBachelors = weighted.mean(bachelors25to64/total25to64, total25to64)) %>%
  ungroup() %>%
  mutate(AvgRent = RentOccupied/OwnershipTotal,
         Poc = (TotalPopRace - PopWhiteAlone)/TotalPopRace, 
         Bachelors = bachelors25to64/total25to64, 
         highRent = case_when(AvgRent >= CityAvgRent ~ 1, 
                                        TRUE ~ 0), 
         highPoc = case_when(Poc >= CityPoc ~ 1, 
                                       TRUE ~ 0), 
         lowInc = case_when(medianIncome <= CityAvgInc ~ 1, 
                                      TRUE ~ 0), 
         lowBachelors = case_when(Bachelors <= CityBachelors ~ 1, 
                                            TRUE ~ 0), 
         totGent = highRent + highPoc + lowInc + lowBachelors, 
         bates = case_when(totGent >= 3 ~ 1, 
                                     TRUE ~0)) %>%
  select(bates, tract) %>%
  st_drop_geometry()
```

# Combine methods and identify gentrifiable tracts

```{r}
gentrifiable <- gentDing %>%
  left_join(gentFreeman, by = "tract") %>%
  left_join(gentBates, by = "tract") %>%
  mutate(canGent = as.factor(case_when(Ding+freeman + bates >=2 ~ 1, 
                                  TRUE ~ 0))) %>%
  filter(tract != "9800") %>%
  mutate(tract = as.numeric(tract))
```

```{r}
roads_sub <- st_crop(roads,st_bbox(gentrifiable))

gentrifiable %>%
  mutate(canGent = case_when(canGent == "1" ~ "Yes", 
                             TRUE ~ "No")) %>%
  ggplot()+
  geom_sf(aes(fill=canGent), lwd = 0.2, color = "white")+
  geom_sf(data = roads_sub, fill = "gray",color = "gray", lwd= 0.5)+
  theme_classic()+
  labs(title = "Gentrifiable census tracts in Minneapolis-Saint Paul in 2010", fill = "Gentrifiable", x = "", y = "")+
  annotate("point", x = -93.1691, y = 44.938, colour = "orange", size = 1) +
  theme(axis.line = element_blank(), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(),
        legend.title = element_markdown(family = "mono"),
        plot.title.position = "plot", 
        plot.title = element_markdown(family = "mono", size = 10))+
  scale_fill_pretty_d(name = "Autumn", direction = -1)
  
locations <- data.frame(location = c("Macalester College"), latitude = c(44.9380), longitude = c(93.1691))
```

# Identifying census tract changes from 2010 to 2020

```{r}
acs2010metro <- acs2010 %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  arrange(GEOID) %>%
  mutate(year2010 = 2010) %>%
  select(tract, year2010, county)
acs2020metro <- acs2020  %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  arrange(GEOID) %>%
  mutate(year2020 = 2020) %>%
  select(tract, year2020, county)

acs2020metro %>%
  full_join(acs2010metro, by= c("tract")) %>%
  filter(is.na(year2020) | is.na(year2010) |is.na(county.x)|is.na(county.y)| county.x != county.y) %>% 
  mutate(tract = as.numeric(tract)) %>%
  arrange(tract)
```

Changes
- Hennepin 38 in 2010 --> 38.01, 38.02 in 2020 \
- Hennepin 202 --> 202.01, 202.02 \
- Hennepin 232 --> 232.01, 232.02 \
- Hennepin 234 --> 234.01, 234.02 \
- Hennepin 249.01, 249.02 --> 249.04 in 2020 \ ****
- Hennepin 257.01 --> 257.03, 257.04 in 2020 \
- Hennepin 259.03 --> 259.08, 259.09 in 2020 \
- Hennepin 260.16 --> 260.23, 260.24 in 2020 \
- Hennepin 260.18 --> 260.25, 260.26 in 2020 \
- Hennepin 260.22 --> 260.27, 260.28 in 2020 \
- Hennepin 264.02 --> 264.05, 264.06 in 2020 \
- Hennepin 265.12 --> 265.15, 265.16 \
- Hennepin 266.12 --> 266.14, 266.15 \
- Hennepin 266.13 --> 266.16, 266.17 \
- Hennepin 267.10 --> 267.24, 267.25, 267.26 \
- Hennepin 267.14 --> 267.17, 267.18 \
- Hennepin 267.15 --> 267.19, 167.22, 267.23 \
- Hennepin 267.16 --> 267.20, 267.21 \
- Hennepin 268.10 --> 268.27, 268.28 \
- Hennepin 268.20 --> 268.24, 268.25, 268.26 \
- Hennepin 269.09	--> 269.11, 269.12 \
- Hennepin 272.01 --> 272.04, 272.05 \
- Hennepin 277.00 --> 277.01, 277.02, 277.03 \
- Ramsey 342.02 --> 342.03, 342.04 \
- Ramsey 376.02 --> 376.03, 376.04 \
- Ramsey 401.00 --> 401.01, 401.02 \
- Ramsey 406.04 --> 406.05, 406.06 \
- Ramsey 407.03 --> Ramsey 407.08, 407.09 \
- Ramsey 408.02, 408.03 --> 408.04, 408.05 \
- Ramsey 430.00 --> 430.01, 430.02 \
- Hennepin 1023.00 + 1029.00 --> Hennepin 1263.00 in 2020 \
- Hennepin 1040.00 --> 1040.01, 1040.02 \
- Hennepin 1048.00 --> 1048.01, 1048.02 \
- Hennepin 1049.00 --> 1049.01, 1049.02 \
- Hennepin 1261.00 --> 1261.01, 1261.02 \
- Hennepin 1262.00 --> 1262.01, 1262.02 \

```{r}
# filter for tracts to be duplicated (tracts that become 2 tracts)
halvedtracts <- gentrifiable %>%
  filter(tract %in% c(38.00, 202.00, 232.00, 234.00, 257.01, 259.03, 260.16, 260.18, 260.22, 264.02, 265.12, 266.12, 266.13, 267.14, 267.16, 268.10, 269.09, 272.01, 342.02, 376.02, 401.00, 406.04, 407.03, 430.00, 1040.00, 1048.00, 1049.00, 1261.00, 1262.00)) %>%
  mutate(modified = "double")

#filter for tracts to be tripled (tracts to become 3 tracts)
thirdtracts <- gentrifiable %>%
  filter(tract %in% c(267.10, 267.15, 268.20, 277.00)) %>%
  mutate(modified = "triple")

#filter for tracts to be combined 
oddtracts <- gentrifiable %>%
  filter(tract %in% c(408.02, 408.03, 1023.00, 1029.00)) %>%
  mutate(modified = "merged")
  


gentrifiable %>%
  filter(!(tract %in% c(408.02, 408.03, 1023.00, 1029.00, 267.10, 267.15, 268.20, 277.00, 38.00, 202.00, 232.00, 234.00, 257.01, 259.03, 260.16, 260.18, 260.22, 264.02, 265.12, 266.12, 266.13, 267.14, 267.16, 268.10, 269.09, 272.01, 342.02, 376.02, 401.00, 406.04, 407.03, 430.00, 1040.00, 1048.00, 1049.00, 1261.00, 1262.00))) %>%
  mutate(modified = "none") %>%
  bind_rows(halvedtracts) %>%
  bind_rows(halvedtracts) %>%
  bind_rows(thirdtracts) %>%
  bind_rows(thirdtracts) %>%
  bind_rows(thirdtracts) %>%
  bind_rows(oddtracts)

acs2020 %>%
  filter(county %in% c("Hennepin", "Ramsey")) %>%
  mutate(modified_tract = tract, 
         modified_tract = case_when(modified_tract == "" ~ ,),
         modified = case_when(tract != modified_tract ~ 1, 
                              TRUE ~ 0))
```


# Methods for idenifying tracts that did gentrify

Freeman \
- change in the share of adults with college degrees is greater than the regional change \
- tract experienced an increase in home values (in constant dollars).

Ding: \
- change in the share of adults with college degrees greater than the city-level change \
- change in median rents above the citywide change OR \
- change in median home value greater than the citywide change. \



