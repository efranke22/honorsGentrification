---
title: "Crime Modeling"
author: "Erin Franke"
date: "2022-10-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(sf)
```

## Minneapolis modeling

```{r}
load("Data/CrimeCleaned/tract_aggregated_minneapolis.RData")
load("Data/CrimeCleaned/tract_aggregated_sp.RData")
```

```{r}
crimes_wide_minn <- tract_aggregated %>%
  st_drop_geometry() %>%
  pivot_wider(id_cols = c(tractmod:canGent_gentrified),names_from = year, values_from = c(Theft, Violent, violent_per_1000, theft_per_1000))
crimes_wide_minn$canGent_gentrified <- relevel(crimes_wide_minn$canGent_gentrified, ref = "Could, but didn't gentrify")

crimes_wide_sp <- tract_aggregated_sp %>%
  st_drop_geometry() %>%
  pivot_wider(id_cols = c(tractmod:canGent_gentrified),names_from = year, values_from = c(Theft, Violent, violent_per_1000, theft_per_1000))
crimes_wide_sp$canGent_gentrified <- relevel(crimes_wide_sp$canGent_gentrified, ref = "Could, but didn't gentrify")
```

### Violent crimes in Minneapolis

```{r}
minn_violent19 <- glm(Violent_2019 ~ canGent_gentrified + Violent_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_violent19)

minn_violent20 <- glm(Violent_2020 ~ canGent_gentrified + Violent_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_violent20)

minn_violent22 <- glm(Violent_2022 ~ canGent_gentrified + Violent_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_violent22)
```

### Theft in Minneapolis 

```{r}
minn_theft19 <- glm(Theft_2019 ~ canGent_gentrified + Theft_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_theft19)

minn_theft20 <- glm(Theft_2020 ~ canGent_gentrified + Theft_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_theft20)

minn_theft22 <- glm(Theft_2022 ~ canGent_gentrified + Theft_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_theft22)
```

## Saint Paul Models

### Violent Crimes 

```{r}
sp_violent19 <- glm(Violent_2019 ~ canGent_gentrified + Violent_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_violent19)

sp_violent20 <- glm(Violent_2020 ~ canGent_gentrified + Violent_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_violent20)

sp_violent22 <- glm(Violent_2022 ~ canGent_gentrified + Violent_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_violent22)
```

### Theft

```{r}
sp_theft19 <- glm(Theft_2019 ~ canGent_gentrified + Theft_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_theft19)

sp_theft20 <- glm(Theft_2020 ~ canGent_gentrified + Theft_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_theft20)

sp_theft22 <- glm(Theft_2022 ~ canGent_gentrified + Theft_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_theft22)
```


```{r}
library(stargazer)
stargazer(minn1, minn2, minn3, minn4, title="Table 1: Minneapolis Overall Crime Models", type="latex", align=TRUE, dep.var.labels = "2019 crime rate", covariate.labels=c("Cannot Gentrify","Gentrified", "2010-2011 Crime Rate","2010 Population"), column.labels = c("Combined", "Freeman", "Ding", "PEW"), no.space=TRUE, report=("vc*p"))
```
