---
title: "Crime Modeling"
author: "Erin Franke"
date: "2022-10-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(sf)
```

## Minneapolis modeling

```{r}
load("Data/CrimeCleaned/tract_aggregated_minneapolis.RData")
load("Data/CrimeCleaned/tract_aggregated_sp.RData")
```

```{r}
crimes_wide_minn <- tract_aggregated %>%
  st_drop_geometry() %>%
  pivot_wider(id_cols = c(tractmod:canGent_gentrified),names_from = year, values_from = c(Theft, Violent, violent_per_1000, theft_per_1000))
crimes_wide_minn$canGent_gentrified <- relevel(crimes_wide_minn$canGent_gentrified, ref = "Could, but didn't gentrify")

crimes_wide_sp <- tract_aggregated_sp %>%
  st_drop_geometry() %>%
  pivot_wider(id_cols = c(tractmod:canGent_gentrified),names_from = year, values_from = c(Theft, Violent, violent_per_1000, theft_per_1000))
crimes_wide_sp$canGent_gentrified <- relevel(crimes_wide_sp$canGent_gentrified, ref = "Could, but didn't gentrify")
```

```{r}
minn_violent <- glm(Violent_2020 ~ canGent_gentrified + Violent_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_violent)

minn_theft <- glm(Theft_2020 ~ canGent_gentrified + Theft_2010 + offset(log(population_2020)),
    data = crimes_wide_minn, family = poisson(link=log))
summary(minn_theft)

tract_aggregated %>%
  st_drop_geometry() %>%
  group_by(canGent_gentrified,year) %>%
  summarize(avg = mean(violent_per_1000)) %>%
  mutate(year = as.numeric(year)) %>%
  ggplot(aes(x=year, y=avg, color = canGent_gentrified))+
  geom_line()

tract_aggregated %>%
  st_drop_geometry() %>%
  group_by(canGent_gentrified,year) %>%
  summarize(avg = mean(theft_per_1000)) %>%
  mutate(year = as.numeric(year)) %>%
  ggplot(aes(x=year, y=avg, color = canGent_gentrified))+
  geom_line()
```

```{r}
sp_violent <- glm(Violent_2020 ~ canGent_gentrified + Violent_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_violent)

sp_theft <- glm(Theft_2020 ~ canGent_gentrified + Theft_2015 + offset(log(population_2020)),
    data = crimes_wide_sp, family = poisson(link=log))
summary(sp_theft)
```

```{r}
library(stargazer)
stargazer(minn1, minn2, minn3, minn4, title="Table 1: Minneapolis Overall Crime Models", type="latex", align=TRUE, dep.var.labels = "2019 crime rate", covariate.labels=c("Cannot Gentrify","Gentrified", "2010-2011 Crime Rate","2010 Population"), column.labels = c("Combined", "Freeman", "Ding", "PEW"), no.space=TRUE, report=("vc*p"))
```
