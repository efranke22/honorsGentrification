---
title: "Determining Gentrified Tracts"
author: "Erin Franke"
date: "2022-09-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the 4th file in my data cleaning and exploration process. \
Steps in this file: Identify census tracts that did and did not gentrify.  \

```{r}
library(tidycensus)
library(tidyverse)
library(survey)
library(srvyr)
library(sf)
load("Data/tractData/cleaned/acs2010clean.RData")
load("Data/tractData/cleaned/acs2020clean.RData")
load("Data/tractData/cleaned/final_condensed.RData")
load("Data/tractData/cleaned/gentrifiable.RData")
```

## Methods for idenifying tracts that did gentrify

The Twin Cities paper identifies three research methods of defining gentrification.

Freeman: both required \
- change in the share of adults with college degrees is greater than the regional change \
- tract experienced an increase in home values (in constant dollars).

```{r}
#regional change in share of adults with college degrees
final_condensed %>%
  ungroup() %>%
  summarize(avg_propbachelors2010 = weighted.mean(bachelors25to64_2010/population_2010, population_2010), 
         avg_propbachelors2020 = weighted.mean(bachelors25to64_2020/population_2020, population_2020), 
         avg_change_bachelors = mean(avg_propbachelors2020 - avg_propbachelors2010, na.rm = TRUE))
```

Ding: \
- change in the share of adults with college degrees greater than the city-level change \
- change in median rents above the citywide change OR \
- change in median home value greater than the citywide change. \

```{r}
#citywide changes needed for Ding's method
final_condensed %>%
  group_by(county_2020) %>%
  summarize(avg_propbachelors2010 = weighted.mean(bachelors25to64_2010/population_2010, population_2010), 
         avg_propbachelors2020 = weighted.mean(bachelors25to64_2020/total25to64_2020, population_2010), 
         avg_change_bachelors = mean(avg_propbachelors2020 - avg_propbachelors2010),
         avg_home_value_increase = mean(medianHomeValue_2020 - medianHomeValue_2010, na.rm = TRUE),
         avg_percent_rent_increase = mean((medContractRent_2020 - medContractRent_2010)/medContractRent_2010, na.rm = TRUE))
```

Bates methodology was too complex for the data provided and the purpose of this project, so for a third method I focused on median income increase. If the tract experienced an increase in median income greater than 67th quantile of the region, I denoted the tract to have gentrified for this method.

```{r}
#regional change in median income
final_condensed %>%
  ungroup() %>%
  summarize(medIncChange = quantile((medianIncome_2020 - medianIncome_2010)/medianIncome_2010, 0.67))
```
  
## Find gentrified tracts 

Second, create a final `gentrified` dataset that lists whether each or not each census tract was gentrifiable and if it did gentrify according to Ding and Freeman's methods.
```{r}
gent_clean <- gentrifiable %>%
  mutate(propbachelors2010 = bachelors25to64_2010/total25to64_2010, 
         propbachelors2020 = bachelors25to64_2020/total25to64_2020, 
         change_bachelors = propbachelors2020 - propbachelors2010,
         home_value_increase = medianHomeValue_2020 - medianHomeValue_2010,
         percent_rent_increase = (medContractRent_2020 - medContractRent_2010)/(medContractRent_2010),
         medIncIncrease = (medIncome_2020-medIncome_2010)/medIncome_2010) %>%
  mutate(freeman = as.factor(case_when(canGent == "1" & change_bachelors > 0.06020412 & home_value_increase > 0 ~ 1, TRUE ~ 0)), 
         ding = as.factor(case_when((canGent == "1" & county == "Hennepin" & change_bachelors > 0.06762064 & 
                                       (percent_rent_increase > 0.3581635 | percent_rent_increase > 37945.32)) |
                                      (canGent == "1" & county == "Ramsey" & change_bachelors > 0.04282828 &
                                         (percent_rent_increase > 0.3749619| percent_rent_increase > 18120.00)) ~ 1, 
                          TRUE ~ 0)), 
         bostic_var = as.factor(case_when(canGent == "1" & medIncIncrease > 0.3587 ~ 1, 
                                        TRUE ~ 0)), 
         twoGentried = as.factor(case_when((ding == "1" & freeman == "1" & bostic_var == "1")|
                                   (ding == "1" & freeman == "1" & bostic_var == "0")|
                                      (ding == "1" & freeman == "0" & bostic_var == "1")|
                                   (ding == "0" & freeman == "1" & bostic_var == "1") ~ 1, 
                                 TRUE ~ 0)), 
         canGent_gentrified = as.factor(case_when(canGent == "0" ~ "0", 
                                                  canGent == "1" & twoGentried == "0" ~ "1", 
                                                  TRUE ~ "2")))
```

```{r, eval=FALSE}
save(gent_clean, file = 'Data/gent_clean.RData')
```


Understand what proportion of tracts that could gentrify did. 
```{r}
gent_clean %>%
  filter(canGent == "1") %>%
  ungroup()%>%
  count(freeman, ding, bostic_var)
```

