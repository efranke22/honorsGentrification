---
title: "Crime Exploratory Data Analysis"
author: "Erin Franke"
date: "2022-10-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the 6th file in my data cleaning and exploration process. \
Steps in this file: Exploratory graphs using cleaned Minneapolis and Saint Paul crime data. 

## Data Loading 

```{r}
# Libraries 
library(tidyverse)
library(NatParksPalettes)
library(PrettyCols)
library(ggmap)
library(sf)
library(viridis)

load('Data/tractData/cleaned/gent_clean.RData')
roads <- st_read("ShpData/tl_2019_27_prisecroads")

#Minneapolis
load("Data/Crime/minneapolisCrime.RData")
load('Data/CrimeCleaned/tract_aggregated_minneapolis.RData')
load('Data/CrimeCleaned/tract_points_minneapolis.RData')
load('Data/CrimeCleaned/tract_aggregated_no_auto.RData')

#Saint Paul
load('Data/CrimeCleaned/tract_aggregated_sp.RData')
load("Data/CrimeCleaned/tract_points_sp.RData")
```

Add in yearly population approximates

```{r}
tract_aggregated <- tract_aggregated %>%
  group_by(tractmod) %>%
  mutate(yearly_dif = (population_2020 - population_2010)/10,
         year = as.numeric(year),
         pop_apprx = case_when(year %in% 2010:2019 ~ population_2010 + yearly_dif*(year-2010), 
                               TRUE ~ population_2020),
         violent_1000_apprx = 1000*(Violent/pop_apprx), 
         theft_1000_apprx = 1000*(Theft/pop_apprx)) %>%
  ungroup()

tract_aggregated_no_auto <- tract_aggregated_no_auto %>%
  group_by(tractmod) %>%
  mutate(yearly_dif = (population_2020 - population_2010)/10,
         year = as.numeric(year),
         pop_apprx = case_when(year %in% 2010:2019 ~ population_2010 + yearly_dif*(year-2010), 
                               TRUE ~ population_2020),
         violent_1000_apprx = 1000*(Violent/pop_apprx), 
         theft_1000_apprx = 1000*(Theft/pop_apprx)) %>%
  ungroup()

tract_aggregated_sp <- tract_aggregated_sp %>%
  group_by(tractmod) %>%
  mutate(yearly_dif = (population_2020 - population_2010)/10,
         year = as.numeric(year),
         pop_apprx = case_when(year %in% 2010:2019 ~ population_2010 + yearly_dif*(year-2010), 
                               TRUE ~ population_2020),
         violent_1000_apprx = 1000*(Violent/pop_apprx), 
         theft_1000_apprx = 1000*(Theft/pop_apprx)) %>%
  ungroup()
```

Graph of type of thefts in Minneapolis overtime

```{r}
minneapolisCrime <- minneapolisCrime %>%
  filter(year != 2023) %>%
  mutate(offenseCat = case_when(Offense %in% c("THEFT", "TFMV", "BURGD", "AUTOTH", "BURGB", "BIKETF", "TMVP", "THFTSW", "SHOPLF", "TFPER", "TBLDG", "CARJCK", "MVTHFT", "COINOP", "SCRAP", "POCKET", "PETIT", "PKGTHEFT", "LOOT") ~ "Theft", 
                   Offense %in% c("ASLT2", "ROBPER", "CSCR", "DASTR", "DASLT2", "ASLT3", "ROBBIZ", "ROBPAG", "ARSON", "ASLT4", "DASLT3", "MURDR", "ASLT1", "ADLTTN", "DASLT1", "DISARM", "ABSVAR") ~ "Violent",
                   TRUE ~ "random")) %>% 
  filter(offenseCat != "random")

minneapolisCrime %>%
  filter(offenseCat != "random") %>%
  mutate(OffenseGroup = case_when(Offense %in% c("AUTOTH", "TMVP", "CARJCK", "MVTHFT") ~ "Auto Theft", 
                                  Offense %in% c("THEFT", "TFMV", "BURGD", "BURGB", "BIKETF", "THFTSW", "SHOPLF", "TFPER", "TBLDG", "COINOP", "SCRAP", "POCKET", "PETIT", "PKGTHEFT", "LOOT") ~ "Theft (no auto)", 
                                   TRUE ~ "Violent")) %>%
  count(OffenseGroup, year) %>%
  ggplot(aes(x=as.numeric(year), y=n, color = OffenseGroup))+
  geom_point()+
  geom_line()+
  theme_classic()+
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018, 2020, 2022))+
  scale_y_continuous(labels = scales::comma)+
  labs(title = "Minneapolis Annual Crime Count", color = "Offense", y = "Count", x = "Year")+
  scale_color_manual(values = c("#024D72", "#6FA1B7", "#D07061"))+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        legend.title = element_text(family = "mono"), 
        axis.title = element_text(family = "mono"), 
        axis.text = element_text(family = "mono"))
```

Spatial crime patterns: Theft and violent crime maps for 2010 and 2020 in Minneapolis.

```{r}
tract_aggregated %>%
  filter(year %in% c(2010, 2020)) %>%
  mutate(violentD= case_when(Violent <=10 ~ "0-10",
                               Violent >10 & Violent  <=25 ~ "11-25",
                               Violent >25 & Violent <= 50 ~ "26-50", 
                               Violent >50 & Violent <= 100 ~ "51-100",
                               TRUE ~ "101+")) %>%
  mutate(violentD= fct_relevel(violentD, levels = c("0-10", "11-25", "26-50", "51-100", "101+"))) %>%
  ggplot()+
  geom_sf(aes(fill = violentD))+
  facet_wrap(~year)+
  scale_fill_brewer(palette = "Blues")+
  theme_classic()+
  theme(axis.line = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(hjust=0.5, family = "mono"), 
        strip.background = element_blank(), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        strip.text = element_text(family = "mono"))+
  labs(title = "Violent crime count by census tract", fill = "Count")

tract_aggregated %>%
  filter(year %in% c(2010, 2020)) %>%
  mutate(theftD= case_when(Theft <=90 ~ "38-90",
                               Theft >90 & Theft  <=130 ~ "91-130",
                               Theft >130 & Theft <= 200 ~ "131-200", 
                               TRUE ~ "201+")) %>%
  mutate(theftD= fct_relevel(theftD, levels = c("38-90", "91-130", "131-200", "201+"))) %>%
  ggplot()+
  geom_sf(aes(fill = theftD))+
  facet_wrap(~year)+
  scale_fill_brewer(palette = "Blues")+
  theme_classic()+
  #annotate("point", x = -93.2277, y = 44.974, colour = "white", size = 1) +
  theme(axis.line = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(hjust=0.5, family = "mono"), 
        strip.background = element_blank(), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        strip.text = element_text(family = "mono"))+
  labs(title = "Theft count by census tract", fill = "Count", x = "", y="")
```

Table: Theft and Violent Crime by gentrification status

```{r}
tract_aggregated %>%
  st_drop_geometry() %>%
  filter(year %in% c(2010, 2020)) %>%
  dplyr::select(population_2020, population_2010, bachelors_2010, bachelors_2020, medianIncome_2010, medianIncome_2020, medianHomeValue_2020, medianHomeValue_2010, medContractRent_2010, medContractRent_2020, canGent2010, gentrified, Violent, Theft, year) %>%
  mutate(Gentrification_status = case_when(canGent2010 == "No" ~ "Cannot Gentrify", 
                                           canGent2010 == "Yes" & gentrified == "0" ~ "Could, but didn't gentrify",
                                           TRUE ~ "Gentrified")) %>%
  group_by(Gentrification_status, year) %>%
  summarize(`2010 Population` = mean(population_2010), 
            `2020 Population` = mean(population_2020), 
            `2010 Bachelors %` = weighted.mean(bachelors_2010/population_2010, population_2010),
            `2020 Bachelors %` = weighted.mean(bachelors_2020/population_2020, population_2020),
            `2010 Median Income` = weighted.mean(medianIncome_2010, population_2010), 
            `2020 Median Income` = weighted.mean(medianIncome_2020, population_2020, na.rm=TRUE),
            `2010 Median Home Value` = weighted.mean(medianHomeValue_2010, population_2010), 
            `2020 Median Home Value` = weighted.mean(medianHomeValue_2020, population_2020, na.rm=TRUE),
            `2010 Median Contract Rent` = weighted.mean(medContractRent_2010, population_2010), 
            `2020 Median Contract Rent` = weighted.mean(medContractRent_2020, population_2020), 
            `2010 Violent` = weighted.mean(Violent, population_2010), 
            `2020 Theft` = weighted.mean(Theft, population_2020))

(17.98/3360)*1000
(22.51/3751)*1000
(165.66/3360)*1000
(169.48/3751)*1000
(46.43/3461)*1000
(63.92/3978)*1000
(189.36/3461)*1000
(229.59/3978)*1000
(33.98/2954)*1000
(46.44/3176)*1000
(138.46/2954)*1000
(182.34/3176)*1000

summary = data.frame(`Variable` = c("Violent Crimes/1000 residents", "", "Thefts/1000 residents", "", "Population", "", "Bachelor's %", "", "Median Income", "", "Median Home Value", "", "Median Contract Rent", ""), `Cannot gentrify` = c("5.4", "6","49.3", "45.2", "3,360", "3,751", "35", "39", "67,409", "93,704", "284,316", "326,643", "875", "1,185"), `Could, but didn't gentrify`= c("13.4", "16.1", "54.7", "57.7", "3,461", "3,978", "16", "17", "28,531", "41,773", "202,200", "213,995", "681", "901"), Gentrified= c("11.5", "14.6", "46.9", "57.4", "2,954", "3,176", "18", "29", "33,493", "53,371", "203,519", "250,008", "668", "941"), check.names = FALSE)
xtable(summary)
```

Explore 2020 distribution of violent crimes (as a rate)

```{r}
mn2020 <- tract_aggregated %>%
  filter(year == 2020) %>%
  dplyr::select(tractmod, year, violent_1000_apprx) %>%
  mutate(violent_d = case_when(violent_1000_apprx <=5 ~ "0-5",
                               violent_1000_apprx >6 & violent_1000_apprx  <=10 ~ "6-10",
                               violent_1000_apprx  >10 & violent_1000_apprx <= 15 ~ "11-15", 
                               TRUE ~ "16+"))
sp2020 <- tract_aggregated_sp %>%
  filter(year == 2020) %>%
  dplyr::select(tractmod, year, violent_1000_apprx) %>%
  mutate(violent_d = case_when(violent_1000_apprx <=5 ~ "0-5",
                               violent_1000_apprx >6 & violent_1000_apprx  <=10 ~ "6-10",
                               violent_1000_apprx  >10 & violent_1000_apprx <= 15 ~ "11-15", 
                               TRUE ~ "16+"))

bind_rows(mn2020, sp2020) %>%
  mutate(violent_d = fct_relevel(violent_d, levels = c("0-5", "6-10", "11-15", "16+"))) %>%
  ggplot()+
  geom_sf(aes(fill =violent_d), override.order=TRUE)+
  theme_classic()+
  scale_fill_brewer(palette = "Blues")+
  labs(title = "Violent crimes per 1000 residents in 2020 by census tract", fill = "", y = "", x = "")+
  annotate("point", x = -93.1691, y = 44.938, colour = "black", size = 1) +
  annotate(geom = "text", x = -93.1691, y = 44.945, label = "Macalester \nCollege", size = 3, color = "black")+
  annotate("point", x = -93.1022, y = 44.955, colour = "black", size = 1) +
  annotate(geom = "text", x = -93.1022, y = 44.9525, label = "Capitol", size = 3, color = "black")+
  annotate("point", x = -93.2776, y = 44.9817, colour = "black", size = 1) +
  annotate(geom = "text", x = -93.285, y = 44.9817, label = "Target \nField", size = 3, color = "black")+
  annotate("point", x = -93.2732, y = 44.9585, colour = "black", size = 1) +
  annotate(geom = "text", x = -93.2732, y = 44.9615, label = "MIA", size = 3, color = "black")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size = 12), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(), 
        axis.line = element_blank(), 
        legend.text = element_text(family = "mono"))

mn2020 %>%
mutate(violent_d = fct_relevel(violent_d, levels = c("0-5", "6-10", "11-15", "16+"))) %>%
  ggplot()+
  geom_sf(aes(fill =violent_d), override.order=TRUE)+
  theme_classic()+
  scale_fill_brewer(palette = "Blues")+
  labs(title = "Violent Crime", fill = "", y = "", x = "")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size = 10, hjust=0.5), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(), 
        axis.line = element_blank(), 
        legend.text = element_text(family = "mono"))
```

Explore 2020 distribution of thefts (as a rate)

```{r}
mn2020 <- tract_aggregated %>%
  filter(year == 2020) %>%
  dplyr::select(tractmod, year, theft_1000_apprx) %>%
  mutate(violent_d = case_when(theft_1000_apprx <=25 ~ "0-25",
                               theft_1000_apprx >26 & theft_1000_apprx  <=50 ~ "26-50",
                               theft_1000_apprx  >51 & theft_1000_apprx <= 75 ~ "51-75", 
                               TRUE ~ "76+"))
sp2020 <- tract_aggregated_sp %>%
  filter(year == 2020) %>%
  dplyr::select(tractmod, year, theft_1000_apprx) %>%
  mutate(violent_d = case_when(theft_1000_apprx <=25 ~ "0-25",
                               theft_1000_apprx >25 & theft_1000_apprx  <=50 ~ "26-50",
                               theft_1000_apprx  >51 & theft_1000_apprx <= 75 ~ "51-75", 
                               TRUE ~ "76+"))

bind_rows(mn2020, sp2020) %>%
  mutate(violent_d = fct_relevel(violent_d, levels = c("0-25", "26-50", "51-65", "75+"))) %>%
  ggplot()+
  geom_sf(aes(fill =violent_d), override.order=TRUE)+
  theme_classic()+
  scale_fill_brewer(palette = "Blues")+
  labs(title = "Thefts per 1000 residents in 2020 by census tract", fill = "", y = "", x = "")+
  annotate("point", x = -93.1691, y = 44.938, colour = "white", size = 1) +
  annotate(geom = "text", x = -93.1691, y = 44.945, label = "Macalester \nCollege", size = 2, color = "white")+
  annotate("point", x = -93.1022, y = 44.955, colour = "white", size = 1) +
  annotate(geom = "text", x = -93.1022, y = 44.9525, label = "Capitol", size = 2, color = "white")+
  annotate("point", x = -93.2776, y = 44.9817, colour = "white", size = 1) +
  annotate(geom = "text", x = -93.285, y = 44.9817, label = "Target \nField", size = 2.5, color = "white")+
  annotate("point", x = -93.2732, y = 44.9585, colour = "white", size = 1) +
  annotate(geom = "text", x = -93.2732, y = 44.9615, label = "MIA", size = 2.5, color = "white")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size = 12), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(), 
        axis.line = element_blank(), 
        legend.text = element_text(family = "mono"))

mn2020 %>%
  mutate(violent_d = fct_relevel(violent_d, levels = c("0-25", "26-50", "51-65", "75+"))) %>%
  ggplot()+
  geom_sf(aes(fill =violent_d), override.order=TRUE)+
  theme_classic()+
  scale_fill_brewer(palette = "Blues")+
  labs(title = "Theft", fill = "", y = "", x = "")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size = 10, hjust=0.5), 
        axis.text = element_blank(), 
        axis.ticks = element_blank(), 
        axis.line = element_blank(), 
        legend.text = element_text(family = "mono"))
```

Look at overall trend in number of crimes per year

```{r}
minn_annual <- tract_points %>%
  st_drop_geometry() %>%
  count(year) %>%
  mutate(city = "Minneapolis")

sp_annual <- tract_points_sp %>%
  st_drop_geometry() %>%
  count(year) %>%
  mutate(city = "Saint Paul") %>%
  filter(year != 2022)

bind_rows(minn_annual, sp_annual) %>%
  ggplot(aes(x=year, y=n, color = city))+
  geom_point()+
  geom_line()+
    scale_color_manual(values = c("navy", "goldenrod3"))+
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018, 2020, 2022))+
  theme_classic()+
  labs(x="Year", y= "Number of crimes", title = "Annual Crimes in the Twin Cities", color = "City")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size =12), 
        axis.title = element_text(family = "mono"), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        axis.text = element_text(family = "mono"))
```

```{r}
gent_minn <- tract_aggregated %>%
  st_drop_geometry() %>%
  mutate(canGent = case_when(canGent_gentrified == "Cannot gentrify" ~ "Cannot Gentrify", 
                                  TRUE ~ "Gentrifiable")) %>%
  group_by(year, canGent) %>%
  summarize(avg_violent = mean(violent_1000_apprx), 
            avg_theft = mean(theft_1000_apprx)) %>%
  mutate(year = as.numeric(year), 
         city = "Minneapolis")

gent_minn_no_auto <- tract_aggregated_no_auto %>%
  st_drop_geometry() %>%
  mutate(canGent = case_when(canGent_gentrified == "Cannot gentrify" ~ "Cannot Gentrify", 
                                  TRUE ~ "Gentrifiable")) %>%
  group_by(year, canGent) %>%
  summarize(avg_violent = mean(violent_1000_apprx), 
            avg_theft = mean(theft_1000_apprx)) %>%
  mutate(year = as.numeric(year), 
         city = "Minneapolis")

gent_sp <- tract_aggregated_sp %>%
  st_drop_geometry() %>%
  mutate(canGent = case_when(canGent_gentrified == "Cannot gentrify" ~ "Cannot Gentrify", 
                                  TRUE ~ "Gentrifiable")) %>%
  group_by(year, canGent) %>%
  summarize(avg_violent = mean(violent_1000_apprx), 
            avg_theft = mean(theft_1000_apprx)) %>%
  mutate(year = as.numeric(year), 
         city = "Saint Paul") %>%
  filter(year != 2022)

rbind(gent_minn, gent_sp) %>%
  ggplot(aes(x=year, y=avg_violent, color = as.factor(canGent)))+
  geom_point()+
  geom_line()+
  facet_wrap(~city)+
    scale_color_manual(values = c("navy", "goldenrod3"))+
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018, 2020, 2022))+
  theme_classic()+
  labs(x="Year", y="Violent crimes per 1000 residents" , title = "Annual violent crimes per 1000 residents by 2010 tract gentrification status", color = "")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size =11),
        axis.title = element_text(family = "mono"), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        axis.text = element_text(family = "mono"), 
        strip.background = element_blank(), 
        strip.text = element_text(family = "mono", size =10, face = "bold"))

rbind(gent_minn, gent_sp) %>%
  ggplot(aes(x=year, y=avg_theft, color = as.factor(canGent)))+
  geom_point()+
  geom_line()+
  facet_wrap(~city)+
    scale_color_manual(values = c("navy", "goldenrod3"))+
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018, 2020, 2022))+
  theme_classic()+
  labs(x="Year", y="Thefts per 1000 residents" , title = "Annual thefts per 1000 residents by 2010 tract gentrification status", color = "")+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono", size =11),
        axis.title = element_text(family = "mono"), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        axis.text = element_text(family = "mono"), 
        strip.background = element_blank(), 
        strip.text = element_text(family = "mono", size =10, face = "bold"))
```

```{r}
library(xtable)
saintpaulcrime <- read_csv("Data/Crime/Crime_Incident_Report.csv")
pain <- saintpaulcrime %>%
  filter(ObjectId %in% c(374306, 417624, 3477, 350087, 14)) %>%
  mutate(order = c(1, 2, 4, 3, 5)) %>%
  arrange(order) %>%
  select(DATE, INCIDENT, BLOCK) %>%
  as.data.frame()

saintpaulcrime %>%
  filter(str_detect(BLOCK, " SNELLING"))
xtable(pain, caption = "Table N: Saint Paul Crime Incident Data")
```

# Saint Paul 

```{r}
saintpaulcrime <- read_csv("Data/Crime/Crime_Incident_Report_2023.csv")
saintpaulcrime %>%
  mutate(year = as.numeric(substr(DATE, 1, 4))) %>%
  filter(year != 2014, year!=2023) %>%
  mutate(OffenseCat = case_when(INCIDENT %in% c("Theft", "Burglary", "Vandalism", "Narcotics", "Criminal Damage", "Graffiti", "THEFT") ~ "Theft", 
                                INCIDENT == "Auto Theft" ~ "Auto Theft",
                                INCIDENT %in% c("Simple Asasult Dom.", "Robbery", "Agg. Assault", "Agg. Assault Dom.", "Rape", "Arson", "Simple Assault Dom.", "Simple Assault Dom", "Homicide", "Agg. Assault Dom") ~ "Violent", 
                                TRUE ~ "random")) %>%
  filter(OffenseCat != "random") %>%
  count(OffenseCat, year) %>%
  ggplot(aes(x=as.numeric(year), y=n, color = OffenseCat))+
  geom_point()+
  geom_line()+
  theme_classic()+
  scale_x_continuous(breaks = c(2015, 2017, 2019, 2021))+
  scale_y_continuous(labels = scales::comma)+
  labs(title = "Saint Paul Annual Crime Count", color = "Offense", y = "Count", x = "Year")+
  scale_color_manual(values = c("#024D72", "#6FA1B7", "#D07061"))+
  theme(plot.title.position = "plot", 
        plot.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        legend.title = element_text(family = "mono"), 
        axis.title = element_text(family = "mono"), 
        axis.text = element_text(family = "mono"))
```

```{r}
tract_aggregated_sp %>%
  filter(year %in% c(2020)) %>%
  mutate(violentD= case_when(Violent <=10 ~ "0-10",
                               Violent >10 & Violent  <=25 ~ "11-25",
                               Violent >25 & Violent <= 50 ~ "26-50", 
                               Violent >50 & Violent <= 100 ~ "51-100",
                               TRUE ~ "101+")) %>%
  mutate(violentD= fct_relevel(violentD, levels = c("0-10", "11-25", "26-50", "51-100", "101+"))) %>%
  ggplot()+
  geom_sf(aes(fill = violentD))+
  scale_fill_brewer(palette = "Blues")+
  theme_classic()+
  theme(axis.line = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(hjust=0.5, family = "mono"), 
        strip.background = element_blank(), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        strip.text = element_text(family = "mono"))+
  labs(title = "Recorded violent crime counts by census tract in 2020", fill = "Count")

tract_aggregated_sp %>%
  filter(year %in% c(2020)) %>%
  mutate(theftD= case_when(Theft <=90 ~ "38-90",
                               Theft >90 & Theft  <=130 ~ "91-130",
                               Theft >130 & Theft <= 200 ~ "131-200", 
                               TRUE ~ "201+")) %>%
  mutate(theftD= fct_relevel(theftD, levels = c("38-90", "91-130", "131-200", "201+"))) %>%
  ggplot()+
  geom_sf(aes(fill = theftD))+
  scale_fill_brewer(palette = "Blues")+
  theme_classic()+
  #annotate("point", x = -93.2277, y = 44.974, colour = "white", size = 1) +
  theme(axis.line = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(hjust=0.5, family = "mono"), 
        strip.background = element_blank(), 
        legend.title = element_text(family = "mono"), 
        legend.text = element_text(family = "mono"), 
        strip.text = element_text(family = "mono"))+
  labs(title = "Recorded theft counts by census tract in 2020", fill = "Count", x = "", y="")
```

```{r}
tract_aggregated_sp %>%
  st_drop_geometry() %>%
  filter(year %in% c(2015, 2020)) %>%
  dplyr::select(population_2020, population_2010, bachelors_2010, bachelors_2020, medianIncome_2010, medianIncome_2020, medianHomeValue_2020, medianHomeValue_2010, medContractRent_2010, medContractRent_2020, canGent2010, gentrified, Violent, Theft, year) %>%
  mutate(Gentrification_status = case_when(canGent2010 == "No" ~ "Cannot Gentrify", 
                                           canGent2010 == "Yes" & gentrified == "0" ~ "Could, but didn't gentrify",
                                           TRUE ~ "Gentrified")) %>%
  group_by(Gentrification_status, year) %>%
  summarize(`2010 Population` = mean(population_2010), 
            `2020 Population` = mean(population_2020), 
            `2010 Bachelors %` = weighted.mean(bachelors_2010/population_2010, population_2010),
            `2020 Bachelors %` = weighted.mean(bachelors_2020/population_2020, population_2020),
            `2010 Median Income` = weighted.mean(medianIncome_2010, population_2010), 
            `2020 Median Income` = weighted.mean(medianIncome_2020, population_2020, na.rm=TRUE),
            `2010 Median Home Value` = weighted.mean(medianHomeValue_2010, population_2010), 
            `2020 Median Home Value` = weighted.mean(medianHomeValue_2020, population_2020, na.rm=TRUE),
            `2010 Median Contract Rent` = weighted.mean(medContractRent_2010, population_2010), 
            `2020 Median Contract Rent` = weighted.mean(medContractRent_2020, population_2020), 
            `2010 Violent` = weighted.mean(Violent, population_2010), 
            `2020 Theft` = weighted.mean(Theft, population_2020))

#2015 population 3780, 3746, 2729
(19.5/3780)*1000
(23/3883)*1000
(158.5/3780)*1000
(198.7/3883)*1000
(47.3/3746)*1000
(56.1/3981)*1000
(260/3746)*1000
(285/3981)*1000
(40.7/2729)*1000
(43.2/2802)*1000
(352.7/2729)*1000
(319/2802)*1000


summary = data.frame(`Variable` = c("Violent Crimes/1000 residents", "", "Thefts/1000 residents", "", "Population", "", "Bachelor's %", "", "Median Income", "", "Median Home Value", "", "Median Contract Rent", ""), `Cannot gentrify` = c("5.2", "5.9","41.9", "51.2", "3,780", "3,883", "29", "31", "61,379", "77,289", "256,405", "284,649", "748", "1,027"), `Could, but didn't gentrify`= c("12.6", "14.1", "69.4", "71.6", "3,746", "3,981", "11", "13", "34,359", "47,305", "175,305", "172,867", "648", "859"), Gentrified= c("14.9", "15.4", "129.2", "113.8", "2,729", "2,802", "19", "25", "36,934", "55,062", "200,930", "228,746", "635", "905"), check.names = FALSE)
xtable(summary)
```

